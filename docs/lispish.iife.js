var Lispish=function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},n(e,t)};function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var r=function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},r.apply(this,arguments)};function a(e,n){for(var t=0,r=n.length,a=e.length;t<r;t++,a++)e[a]=n[t];return e}var u=function(e){function n(t){var r=e.call(this,"recur, params: "+t)||this;return Object.setPrototypeOf(r,n.prototype),r.name="RecurSignal",r.params=t,r}return t(n,e),n}(Error),i=function(e){function n(t){var r=e.call(this,t)||this;return Object.setPrototypeOf(r,n.prototype),r.name="UserDefinedError",r}return t(n,e),n}(Error),o=function(e){function n(t){var r=e.call(this,t)||this;return Object.setPrototypeOf(r,n.prototype),r.name="AssertionError",r}return t(n,e),n}(Error),l=function(e){function n(t,r){var a=e.call(this,'Expected a "'+t+'" token, got Token['+r.type+':"'+r.value+'"]')||this;return Object.setPrototypeOf(a,n.prototype),a.name="UnexpectedTokenError",a}return t(n,e),n}(Error),f=function(e){function n(t,r){var a=e.call(this,"Expected a "+t+" node, got "+(r?"a "+r.type+" node":"undefined"))||this;return Object.setPrototypeOf(a,n.prototype),a.name="UnexpectedNodeTypeError",a}return t(n,e),n}(Error),c=Symbol("function");function v(e){if(void 0===e)throw Error("Expected an AST node, got undefined");return e}function s(e){if(void 0===e||"Name"!==e.type)throw new f("Name",e)}function p(e,n){if(void 0===n&&(n="Unexpected end of input"),void 0===e)throw Error(n);return e}function d(e){if(void 0===e)throw Error("Expected non undefined value, got "+e);return e}function m(e){if(void 0===e)throw Error("Expected non undefined value, got "+e)}function h(e){if("number"!=typeof e||!isFinite(e))throw TypeError("Expected number, got: "+e+' type="'+typeof e+'"')}function g(e){!function(e){if(h(e),e<0)throw TypeError("Expected non negative number, got "+e)}(e),y(e)}function y(e){if(h(e),!Number.isInteger(e))throw TypeError("Expected integer, got "+e)}function b(e,n){if(h(e),e<n)throw TypeError("Expected parameter ("+e+") to be a number equal or grater than "+n)}function x(e){return"string"==typeof e}function E(e){if(!x(e))throw TypeError("Expected string, got: "+e+' type="'+typeof e+'"')}function w(e){if(!x(e))throw TypeError("Expected string, got: "+e+' type="'+typeof e+'"');return e}function A(e){if(!function(e){return x(e)&&1===e.length}(e))throw TypeError("Expected char, got: "+e+' type="'+typeof e+'"')}function N(e){return A(e),e}function j(e){if("string"!=typeof e&&"number"!=typeof e)throw TypeError("Expected string or number, got: "+e+' type="'+typeof e+'"')}function M(e){if(!(e instanceof RegExp))throw TypeError("Expected RegExp, got: "+e+' type="'+typeof e+'"')}function k(e,n){var t=n.params.length;if("number"==typeof e){if(t!==e)throw Error('Wrong number of arguments to "'+n.name+'", expected '+e+", got "+t)}else{var r=e.min,a=e.max;if(void 0===r&&void 0===a)throw Error("Min or max must be specified");if("number"==typeof r&&t<r)throw Error('Wrong number of arguments to "'+n.name+'", expected at least '+r+", got "+t);if("number"==typeof a&&t>a)throw Error('Wrong number of arguments to "'+n.name+'", expected at most '+a+", got "+t)}}function O(e){var n=e.params.length;if(n%2!=0)throw Error("Wrong number of arguments, expected an even number, got "+n)}function S(e){return null!==e&&"object"==typeof e&&!!e[c]}function T(e){if(!S(e))throw Error("Expected lispish function, got "+JSON.stringify(e))}function I(e){if(!Array.isArray(e)||e.some((function(e){return"string"!=typeof e})))throw Error("Expected an array of strings, got "+e)}function F(e){if(!Array.isArray(e)||e.some((function(e){return"string"!=typeof e||1!==e.length})))throw Error("Expected an array of chars, got "+e)}function P(e){if(!$(e))throw TypeError("Expected a number, got: "+e+' type="'+typeof e+'"')}function R(e){if(!B(e))throw TypeError("Expected Arr, got: "+e+' type="'+typeof e+'"')}function _(e){if(!L(e))throw TypeError("Expected collection, got: "+e+' type="'+typeof e+'"')}function q(e){if(!function(e){return void 0!==e}(e))throw TypeError("Expected Any, got: "+e+' type="'+typeof e+'"')}function C(e){if(!D(e))throw TypeError("Expected string or array, got: "+e+' type="'+typeof e+'"')}function V(e){if(!U(e))throw TypeError("Expected object, got: "+e+' type="'+typeof e+'"')}function U(e){return!(null===e||"object"!=typeof e||Array.isArray(e)||e instanceof RegExp||S(e))}function B(e){return Array.isArray(e)}function D(e){return Array.isArray(e)||x(e)}function L(e){return D(e)||U(e)}function $(e){return"number"==typeof e}function z(e){return Number.isInteger(e)}function G(e,n){return!!L(e)&&(x(e)||B(e)?!!z(n)&&(n>=0&&n<e.length):!!Object.getOwnPropertyDescriptor(e,n))}var Y={boolean:0,number:1,string:2,array:3,object:4,regexp:5,unknown:6,null:7};function J(e){return null===e?"null":"boolean"==typeof e?"boolean":"number"==typeof e?"number":"string"==typeof e?"string":B(e)?"array":U(e)?"object":function(e){return e instanceof RegExp}(e)?"regexp":"unknown"}function W(e,n){var t=J(e),r=J(n);if(t!==r)return Math.sign(Y[t]-Y[r]);switch(t){case"null":case"unknown":return 0;case"boolean":return e===n?0:!1===e?-1:1;case"number":return Math.sign(e-n);case"string":return(c=e)<(v=n)?-1:c>v?1:0;case"array":var a=e,u=n;if(a.length<u.length)return-1;if(a.length>u.length)return 1;for(var i=0;i<a.length;i+=1){var o=W(a[i],u[i]);if(0!==o)return o}return 0;case"object":var l=e,f=n;return Math.sign(Object.keys(l).length-Object.keys(f).length);case"regexp":var c,v;return(c=e.source)<(v=n.source)?-1:c>v?1:0}}function X(e,n){if(e===n)return!0;if("number"==typeof e&&"number"==typeof n)return Math.abs(e-n)<Number.EPSILON;if(B(e)&&B(n)){if(e.length!==n.length)return!1;for(var t=0;t<e.length;t+=1)if(!X(p(e[t]),p(n[t])))return!1;return!0}if(e instanceof RegExp&&n instanceof RegExp)return e.toString()===n.toString();if("object"==typeof e&&null!==e&&"object"==typeof n&&null!==n){var r=e,a=n,u=Object.keys(r),i=Object.keys(a);if(u.length!==i.length)return!1;for(t=0;t<u.length;t+=1){var o=w(u[t]);if(!X(K(r[o]),K(a[o])))return!1}return!0}return!1}function H(e){return Math.max(0,Math.ceil(e))}function K(e){return null!=e?e:null}var Z={parse:function(e,n,t){var r;return r=function(e,n,t){for(var r,a,u=[],i=d(e[n]);"paren"!==i.type||")"!==i.value;){var o,l;n=(r=t(e,n))[0],o=r[1],n=(a=t(e,n))[0],l=a[1],u.push({test:o,form:l}),i=d(e[n])}return[n,u]}(e,n,t.parseToken),[(n=r[0])+1,{type:"SpecialExpression",name:"cond",conditions:r[1],params:[]}]},evaluate:function(e,n,t){for(var r=t.evaluateAstNode,a=0,u=e.conditions;a<u.length;a++){var i=u[a];if(r(i.test,n))return r(i.form,n)}return null}},Q={true:{value:!0},false:{value:!1},nil:{value:null}},ee=Object.keys(Q);function ne(e,n,t){if("string"==typeof e){if(t.specialExpressions[e])throw Error("Cannot define variable "+e+", it's a special expression");if(t.normalExpressions[e])throw Error("Cannot define variable "+e+", it's a builtin function");if(Q[e])throw Error("Cannot define variable "+e+", it's a reserved name");if(d(n[n.length-2])[e])throw Error('Name already defined "'+e+'"')}}function te(e){return function(n,t,r){var a,u=r.parseToken,i=r.parseArgument,o=r.parseBindings,c=void 0;if(("defn"===e||"defns"===e)&&(t=(a=u(n,t))[0],c=a[1],"defn"===e&&"Name"!==c.type))throw new f("Name",c);for(var v=function(e,n,t,r){var a,u=[],i=void 0,o=[],f=[],c={},v="mandatory",s=d(e[n]);if("paren"!==s.type||"["!==s.value)throw new l("[",s);for(s=d(e[n+=1]);"paren"!==s.type||"]"!==s.value;){if("bind"===v){n=(a=r(e,n))[0],u=a[1];break}var p=t(e,n),m=p[0],h=p[1];if(s=d(e[n=m]),"Modifier"===h.type)switch(h.value){case"&opt":if("rest"===v)throw Error("&opt cannot appear after &rest");if("optional"===v)throw Error("&opt can only appear once");v="optional";break;case"&rest":if("rest"===v)throw Error("&rest can only appear once");if("optional"===v&&0===f.length)throw Error("No optional arguments where spcified");v="rest";break;case"&bind":if("optional"===v&&0===f.length)throw Error("No optional arguments where spcified");if("rest"===v&&!i)throw Error("No rest argument was spcified");v="bind"}else{if(c[h.name])throw Error('Duplicate argument "'+h.name+'"');if(c[h.name]=!0,Object.getOwnPropertyDescriptor(h,"defaultValue")){if("optional"!==v)throw Error("Cannot specify default value if not an optional argument");f.push({name:h.name,defaultValue:h.defaultValue})}else switch(v){case"mandatory":o.push(h.name);break;case"optional":f.push({name:h.name,defaultValue:void 0});break;case"rest":if(void 0!==i)throw Error("Can only specify one rest argument");i=h.name}}}if("rest"===v&&void 0===i)throw Error("Missing rest argument name");if("optional"===v&&0===f.length)throw Error("No optional arguments where spcified");return[n+=1,{mandatoryArguments:o,optionalArguments:f,restArgument:i,bindings:u}]}(n,t,i,o),s=v[0],p=v[1],m=d(n[t=s]),h=[];"paren"!==m.type||")"!==m.value;){var g=u(n,t),y=g[0],b=g[1];h.push(b),m=d(n[t=y])}if(0===h.length)throw Error('Missing body in special expression "defn"');return t+=1,"defn"===e||"defns"===e?[t,{type:"SpecialExpression",name:e,functionName:c,params:[],arguments:p,body:h}]:[t,{type:"SpecialExpression",name:e,params:[],arguments:p,body:h}]}}function re(e){return function(n,t,r){var a,u=r.evaluateAstNode,i=r.builtin,o=function(e,n,t,r){if("defn"===e){var a=n.functionName.value;return E(a),a}if("defns"===e){var u=r(n.functionName,t);return E(u),u}}(e,n,t,u);ne(o,t,i);for(var l={},f=0,v=n.arguments.bindings;f<v.length;f++){var s=v[f],p=s.value,m=u(p,t);l[s.name]={value:m}}var h=n.arguments.optionalArguments.map((function(e){var n=e.name,r=e.defaultValue;return r?{name:n,defaultValue:u(r,t)}:{name:n}})),g=((a={})[c]=!0,a.type="user-defined",a.name=o,a.arguments={mandatoryArguments:n.arguments.mandatoryArguments,restArgument:n.arguments.restArgument,optionalArguments:h},a.body=n.body,a.functionContext=l,a);return"fn"===e?g:(d(t[t.length-2])[o]={value:g},null)}}var ae={parse:te("defn"),evaluate:re("defn")},ue={parse:te("defns"),evaluate:re("defns")},ie={parse:te("fn"),evaluate:re("fn")},oe={parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"if",params:r[1]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=e.params,u=a[0],i=a[1],o=a[2];return r(v(u),n)?r(v(i),n):3===e.params.length?r(v(o),n):null},validate:function(e){return k({min:2,max:3},e)}},le={parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"if-not",params:r[1]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=e.params,u=a[0],i=a[1],o=a[2];return r(v(u),n)?3===e.params.length?r(v(o),n):null:r(v(i),n)},validate:function(e){return k({min:2,max:3},e)}},fe={parse:function(e,n,t){var r,a,u,i,o=t.parseBindings,l=t.parseTokens;if(n=(r=o(e,n))[0],1!==(u=r[1]).length)throw Error("Expected exactly one binding, got "+u.length);return n=(a=l(e,n))[0],i=a[1],[n+1,{type:"SpecialExpression",name:"if-let",binding:d(u[0]),params:i}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,u={},i=r(e.binding.value,n);if(i){u[e.binding.name]={value:i};var o=a([u],n);return r(d(e.params[0]),o)}return 2===e.params.length?r(d(e.params[1]),n):null},validate:function(e){return k({min:1,max:2},e)}},ce={parse:function(e,n,t){var r,a,u,i,o=t.parseBindings,l=t.parseTokens;if(n=(r=o(e,n))[0],1!==(u=r[1]).length)throw Error("Expected exactly one binding, got "+u.length);return n=(a=l(e,n))[0],i=a[1],[n+1,{type:"SpecialExpression",name:"when-let",binding:d(u[0]),params:i}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,u={},i=r(e.binding.value,n);if(!i)return null;u[e.binding.name]={value:i};for(var o=a([u],n),l=null,f=0,c=e.params;f<c.length;f++){l=r(c[f],o)}return l},validate:function(e){return k({min:0},e)}},ve={parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"when-not",params:r[1]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=e.params,u=a[0],i=a.slice(1);if(m(u),r(u,n))return null;for(var o=null,l=0,f=i;l<f.length;l++){o=r(f[l],n)}return o},validate:function(e){return k({min:1},e)}},se={parse:function(e,n,t){var r,a,u,i,o=t.parseBindings,l=t.parseTokens;if(n=(r=o(e,n))[0],1!==(u=r[1]).length)throw Error("Expected exactly one binding, got "+u.length);return n=(a=l(e,n))[0],i=a[1],[n+1,{type:"SpecialExpression",name:"when-first",binding:d(u[0]),params:i}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,u={},i=r(e.binding.value,n);if(!D(i))throw Error("Expected undefined or a sequence, got "+i);if(0===i.length)return null;var o=K(i[0]);u[e.binding.name]={value:o};for(var l=a([u],n),f=null,c=0,v=e.params;c<v.length;c++){f=r(v[c],l)}return f},validate:function(e){return k({min:0},e)}},pe={parse:function(e,n,t){var r,a,u,i=t.parseBindings,o=t.parseTokens;return n=(r=i(e,n))[0],u=r[1],[(n=(a=o(e,n))[0])+1,{type:"SpecialExpression",name:"let",params:a[1],bindings:u}]},evaluate:function(e,n,t){for(var r=t.evaluateAstNode,u={},i=0,o=e.bindings;i<o.length;i++){var l=o[i],f=r(l.value,n);u[l.name]={value:f}}for(var c=a([u],n),v=null,s=0,p=e.params;s<p.length;s++){v=r(p[s],c)}return v}},de={parse:function(e,n,t){for(var r=t.parseToken,a={type:"SpecialExpression",name:"do",params:[]},u=d(e[n]);"paren"!==u.type||")"!==u.value;){var i=r(e,n),o=i[0],l=i[1];a.params.push(l),u=d(e[n=o])}return[n+1,a]},evaluate:function(e,n,t){for(var r=t.evaluateAstNode,u=a([{}],n),i=null,o=0,l=e.params;o<l.length;o++){i=r(l[o],u)}return i}},me={parse:function(e,n,t){var r=(0,t.parseTokens)(e,n),a=r[0],u=r[1];return s(u[0]),[a+1,{type:"SpecialExpression",name:"def",params:u}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=t.builtin,u=function(e){if(void 0===e||"Name"!==e.type)throw new f("Name",e);return e}(e.params[0]).value;ne(u,n,a);var i=r(v(e.params[1]),n);return d(n[n.length-2])[u]={value:i},i},validate:function(e){return k(2,e)}},he={parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"defs",params:r[1]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=t.builtin,u=r(v(e.params[0]),n);E(u),ne(u,n,a);var i=r(v(e.params[1]),n);return d(n[n.length-2])[u]={value:i},i},validate:function(e){return k(2,e)}},ge={parse:function(e,n,t){var r=(0,t.parseToken)(e,n),a=r[0],u=r[1],i=d(e[n=a]);if("paren"!==i.type||")"!==i.value)throw new l(")",i);return[n+=1,{type:"SpecialExpression",name:"throw",params:[],messageNode:u}]},evaluate:function(e,n,t){var r=function(e){if("string"!=typeof e||0===e.length)throw TypeError("Expected non empty string, got: "+e+' type="'+typeof e+'"');return e}((0,t.evaluateAstNode)(e.messageNode,n));throw new i(r)}},ye={parse:function(e,n,t){var r,a,u,i,o=t.parseToken;n=(r=o(e,n))[0],i=r[1];var c,v,s=d(e[n]);if("paren"!==s.type||"("!==s.value)throw new l("(",s);if("paren"!==(s=d(e[n+=1])).type||"("!==s.value)throw new l("(",s);if(n=(a=o(e,n+=1))[0],"Name"!==(c=a[1]).type)throw new f("Name",c);if("paren"!==(s=d(e[n])).type||")"!==s.value)throw new l(")",s);if(n=(u=o(e,n+=1))[0],v=u[1],"paren"!==(s=d(e[n])).type||")"!==s.value)throw new l(")",s);if("paren"!==(s=d(e[n+=1])).type||")"!==s.value)throw new l(")",s);return[n+=1,{type:"SpecialExpression",name:"try",params:[],tryExpression:i,catchExpression:v,error:c}]},evaluate:function(e,n,t){var r,u=t.evaluateAstNode;try{return u(e.tryExpression,n)}catch(t){var i=((r={})[e.error.value]={value:d(t)},r);return u(e.catchExpression,a([i],n))}}},be={parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"when",params:r[1]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=e.params,u=a[0],i=a.slice(1);if(m(u),!r(u,n))return null;for(var o=null,l=0,f=i;l<f.length;l++){o=r(f[l],n)}return o},validate:function(e){return k({min:1},e)}},xe={parse:function(e,n,t){var r;return[(n=(r=(0,t.parseTokens)(e,n))[0])+1,{type:"SpecialExpression",name:"recur",params:r[1]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=e.params.map((function(e){return r(e,n)}));throw new u(a)}},Ee={parse:function(e,n,t){var r,a,u,i=t.parseTokens;return n=(r=(0,t.parseBindings)(e,n))[0],u=r[1],[(n=(a=i(e,n))[0])+1,{type:"SpecialExpression",name:"loop",params:a[1],bindings:u}]},evaluate:function(e,n,t){for(var r=t.evaluateAstNode,i=e.bindings.reduce((function(e,t){return e[t.name]={value:r(t.value,n)},e}),{}),o=a([i],n),l=function(){var n=null;try{for(var t=0,a=e.params;t<a.length;t++){var l=a[t];n=r(l,o)}}catch(n){if(n instanceof u){var f=n.params;if(f.length!==e.bindings.length)throw Error("recur expected "+e.bindings.length+" parameters, got "+f.length);return e.bindings.forEach((function(e,n){d(i[e.name]).value=p(f[n])})),"continue"}throw n}return{value:n}};;){var f=l();if("object"==typeof f)return f.value}}},we={parse:function(e,n,t){var r=(0,t.parseToken)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"time!",params:[r[1]]}]},evaluate:function(e,n,t){var r=t.evaluateAstNode,a=e.params[0];m(a);var u=Date.now(),i=r(a,n),o=Date.now()-u;return console.log("Elapsed time: "+o+" ms"),i},validate:function(e){return k(1,e)}},Ae={get:{evaluate:function(e){var n=e[0],t=e[1],r=e[2],a=3===e.length;if(_(n),B(n)){if(y(t),t<n.length)return K(n[t])}else{if(!U(n))return y(t),K(n[t]);if(E(t),Object.getOwnPropertyDescriptor(n,t))return K(n[t])}return a?(q(r),r):null},validate:function(e){return k({min:2,max:3},e)}},count:{evaluate:function(e){var n=e[0];return"string"==typeof n?n.length:(_(n),Array.isArray(n)?n.length:Object.keys(n).length)},validate:function(e){return k(1,e)}},"contains?":{evaluate:function(e){var n=e[0],t=e[1];return _(n),j(t),D(n)?!!Number.isInteger(t)&&(y(t),t>=0&&t<n.length):!!Object.getOwnPropertyDescriptor(n,t)},validate:function(e){return k(2,e)}},"has?":{evaluate:function(e){var n=e[0],t=e[1];return _(n),B(n)?n.includes(t):x(n)?!!x(t)&&n.split("").includes(t):Object.values(n).includes(t)},validate:function(e){return k(2,e)}},assoc:{evaluate:function(e){var n=e[0],t=e[1],u=e[2];if(_(n),j(t),Array.isArray(n)||"string"==typeof n){if(y(t),b(t,0),function(e,n){if(h(e),e>n)throw TypeError("Expected parameter ("+e+") to be a number equal or less than "+n)}(t,n.length),"string"==typeof n)return A(u),""+n.slice(0,t)+u+n.slice(t+1);var i=a([],n);return i[t]=u,i}E(t);var o=r({},n);return o[t]=u,o},validate:function(e){return k(3,e)}},concat:{evaluate:function(e){return _(e[0]),B(e[0])?e.reduce((function(e,n){return R(n),e.concat(n)}),[]):x(e[0])?e.reduce((function(e,n){return E(n),""+e+n}),""):e.reduce((function(e,n){return V(n),Object.assign(e,n)}),{})},validate:function(e){return k({min:1},e)}},"empty?":{evaluate:function(e){var n=e[0];return _(n),x(n)||Array.isArray(n)?0===n.length:0===Object.keys(n).length},validate:function(e){return k(1,e)}},"every?":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;return T(r),_(a),Array.isArray(a)?a.every((function(e){return u(r,[e],n)})):x(a)?a.split("").every((function(e){return u(r,[e],n)})):Object.entries(a).every((function(e){return u(r,[e],n)}))},validate:function(e){return k(2,e)}},"any?":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;return T(r),_(a),Array.isArray(a)?a.some((function(e){return u(r,[e],n)})):x(a)?a.split("").some((function(e){return u(r,[e],n)})):Object.entries(a).some((function(e){return u(r,[e],n)}))},validate:function(e){return k(2,e)}},"not-any?":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;return T(r),_(a),Array.isArray(a)?!a.some((function(e){return u(r,[e],n)})):x(a)?!a.split("").some((function(e){return u(r,[e],n)})):!Object.entries(a).some((function(e){return u(r,[e],n)}))},validate:function(e){return k(2,e)}},"not-every?":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;return T(r),_(a),Array.isArray(a)?!a.every((function(e){return u(r,[e],n)})):x(a)?!a.split("").every((function(e){return u(r,[e],n)})):!Object.entries(a).every((function(e){return u(r,[e],n)}))},validate:function(e){return k(2,e)}},update:{evaluate:function(e,n,t){var u=e[0],i=e[1],o=e[2],l=e.slice(3),f=t.executeFunction;if(_(u),j(i),T(o),U(u))return E(i),(v=r({},u))[i]=f(o,a([v[i]],l),n),v;P(i);var c=H(i);if(function(e,n){if(e>n)throw Error("Expected number less than or equal to "+n+"'")}(c,u.length),Array.isArray(u)){var v=u.map((function(e,t){return c===t?f(o,a([e],l),n):e}));return c===u.length&&(v[c]=f(o,a([void 0],l),n)),v}v=u.split("").map((function(e,t){return c===t?N(f(o,a([e],l),n)):e}));return c===u.length&&(v[c]=N(f(o,a([void 0],l),n))),v.join("")},validate:function(e){return k({min:3},e)}}},Ne=function(e,n,t){var r=t.executeFunction,a=e[0],u=e[1];T(a),C(u);var i=x(u),o=u.length;if(2===e.length)return B(u)?u.map((function(e){return r(a,[e],n)})):u.split("").map((function(e){var t=r(a,[e],n);return A(t),t})).join("");if(e.slice(2).forEach((function(e){if(i?E(e):R(e),o!==e.length)throw Error('All arguments to "map" must have the same length')})),i){for(var l="",f=function(t){var u=e.slice(1).map((function(e){return e[t]})),i=r(a,u,n);A(i),l+=i},c=0;c<o;c+=1)f(c);return l}l=[];var v=function(t){var u=e.slice(1).map((function(e){return K(e[t])}));l.push(r(a,u,n))};for(c=0;c<o;c+=1)v(c);return l},je={cons:{evaluate:function(e){var n=e[0],t=e[1];return q(n),C(t),Array.isArray(t)?a([n],t):(A(n),""+n+t)},validate:function(e){return k(2,e)}},nth:{evaluate:function(e){var n=e[0],t=e[1];return C(n),y(t),K(n[t])},validate:function(e){return k(2,e)}},filter:{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;return T(r),C(a),Array.isArray(a)?a.filter((function(e){return u(r,[e],n)})):a.split("").filter((function(e){return u(r,[e],n)})).join("")},validate:function(e){return k(2,e)}},first:{evaluate:function(e){var n=e[0];return C(n),K(n[0])},validate:function(e){return k(1,e)}},last:{evaluate:function(e){var n=e[0];return C(n),K(n[n.length-1])},validate:function(e){return k(1,e)}},map:{evaluate:Ne,validate:function(e){return k({min:2},e)}},pop:{evaluate:function(e){var n=e[0];if(C(n),x(n))return n.substr(0,n.length-1);var t=a([],n);return t.pop(),t},validate:function(e){return k(1,e)}},position:{evaluate:function(e,n,t){var r,a=e[0],u=e[1],i=t.executeFunction;return T(a),C(u),x(u)?-1!==(r=u.split("").findIndex((function(e){return i(a,[e],n)})))?r:null:-1!==(r=u.findIndex((function(e){return i(a,[e],n)})))?r:null},validate:function(e){return k(2,e)}},"index-of":{evaluate:function(e){var n,t=e[0],r=e[1];return q(r),C(t),x(t)?(E(r),-1!==(n=t.indexOf(r))?n:null):-1!==(n=t.indexOf(r))?n:null},validate:function(e){return k(2,e)}},push:{evaluate:function(e){var n=e[0],t=e.slice(1);return C(n),x(n)?(F(t),a([n],t).join("")):a(a([],n),t)},validate:function(e){return k({min:2},e)}},reduce:{evaluate:function(e,n,t){var r=t.executeFunction,a=e[0];if(T(a),2===e.length){var u=e[1];if(C(u),0===u.length)return r(a,[],n);if(1===u.length)return K(u[0]);if(x(u)){var i=u.split("");return i.slice(1).reduce((function(e,t){return r(a,[e,t],n)}),p(i[0]))}return u.slice(1).reduce((function(e,t){return r(a,[e,t],n)}),K(u[0]))}var o=e[1],l=e[2];return q(o),C(l),x(l)?(E(o),0===l.length?o:l.split("").reduce((function(e,t){return r(a,[e,t],n)}),o)):0===l.length?o:l.reduce((function(e,t){return r(a,[e,t],n)}),o)},validate:function(e){return k({min:2,max:3},e)}},"reduce-right":{evaluate:function(e,n,t){var r=t.executeFunction,a=e[0];if(T(a),2===e.length){if(C(o=e[1]),0===o.length)return r(a,[],n);if(1===o.length)return K(o[0]);if(x(o)){var u=o.split("");return u.slice(0,u.length-1).reduceRight((function(e,t){var u=r(a,[e,t],n);return E(u),u}),u[u.length-1])}return o.slice(0,o.length-1).reduceRight((function(e,t){return r(a,[e,t],n)}),p(o[o.length-1]))}var i=e[1],o=e[2];return q(i),C(o),x(o)?0===o.length?i:o.split("").reduceRight((function(e,t){return r(a,[e,t],n)}),i):0===o.length?i:o.reduceRight((function(e,t){return r(a,[e,t],n)}),i)},validate:function(e){return k({min:2,max:3},e)}},rest:{evaluate:function(e){var n=e[0];return C(n),Array.isArray(n)?n.length<=1?[]:n.slice(1):n.substr(1)},validate:function(e){return k(1,e)}},nthrest:{evaluate:function(e){var n=e[0],t=e[1];C(n),h(t);var r=Math.max(Math.ceil(t),0);return Array.isArray(n)?n.slice(r):n.substr(r)},validate:function(e){return k(2,e)}},next:{evaluate:function(e){var n=e[0];return C(n),Array.isArray(n)?n.length<=1?null:n.slice(1):n.length<=1?null:n.substr(1)},validate:function(e){return k(1,e)}},nthnext:{evaluate:function(e){var n=e[0],t=e[1];C(n),h(t);var r=Math.max(Math.ceil(t),0);return n.length<=t?null:Array.isArray(n)?n.slice(r):n.substr(r)},validate:function(e){return k(2,e)}},reverse:{evaluate:function(e){var n=e[0];return C(n),Array.isArray(n)?a([],n).reverse():n.split("").reverse().join("")},validate:function(e){return k(1,e)}},second:{evaluate:function(e){var n=e[0];return C(n),K(n[1])},validate:function(e){return k(1,e)}},shift:{evaluate:function(e){var n=e[0];if(C(n),x(n))return n.substr(1);var t=a([],n);return t.shift(),t},validate:function(e){return k(1,e)}},slice:{evaluate:function(e){var n=e[0],t=e[1],r=e[2];return C(n),1===e.length?n:(y(t),2===e.length?n.slice(t):(y(r),n.slice(t,r)))},validate:function(e){return k({min:1,max:3},e)}},some:{evaluate:function(e,n,t){var r,a=e[0],u=e[1],i=t.executeFunction;return T(a),C(u),0===u.length?null:x(u)?null!==(r=u.split("").find((function(e){return i(a,[e],n)})))&&void 0!==r?r:null:K(u.find((function(e){return i(a,[e],n)})))},validate:function(e){return k(2,e)}},sort:{evaluate:function(e,n,t){var r=t.executeFunction,u=1===e.length,i=u?e[0]:e[1],o=u?null:e[0];if(C(i),x(i)){var l=i.split("");return u?l.sort(W):(T(o),l.sort((function(e,t){var a=r(o,[e,t],n);return h(a),a}))),l.join("")}var f=a([],i);return u?f.sort(W):f.sort((function(e,t){T(o);var a=r(o,[e,t],n);return h(a),a})),f},validate:function(e){return k({min:1,max:2},e)}},take:{evaluate:function(e){var n=e[0],t=e[1];P(n),C(t);var r=Math.max(Math.ceil(n),0);return t.slice(0,r)},validate:function(e){return k(2,e)}},"take-last":{evaluate:function(e){var n=e[0],t=e[1];C(t),P(n);var r=Math.max(Math.ceil(n),0),a=t.length-r;return t.slice(a)},validate:function(e){return k(2,e)}},"take-while":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;C(a),T(r);for(var i=[],o=0,l=a;o<l.length;o++){var f=l[o];if(!u(r,[f],n))break;i.push(f)}return x(a)?i.join(""):i},validate:function(e){return k(2,e)}},drop:{evaluate:function(e){var n=e[0],t=e[1];P(n);var r=Math.max(Math.ceil(n),0);return C(t),t.slice(r)},validate:function(e){return k(2,e)}},"drop-last":{evaluate:function(e){var n=e[0],t=e[1];C(t),P(n);var r=Math.max(Math.ceil(n),0),a=t.length-r;return t.slice(0,a)},validate:function(e){return k(2,e)}},"drop-while":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;if(C(a),T(r),Array.isArray(a)){var i=a.findIndex((function(e){return!u(r,[e],n)}));return a.slice(i)}var o=a.split(""),l=o.findIndex((function(e){return!u(r,[e],n)}));return o.slice(l).join("")},validate:function(e){return k(2,e)}},unshift:{evaluate:function(e){var n=e[0],t=e.slice(1);if(C(n),x(n))return F(t),a(a([],t),[n]).join("");var r=a([],n);return r.unshift.apply(r,t),r},validate:function(e){return k({min:2},e)}},"random-sample!":{evaluate:function(e){var n=e[0],t=e[1];return h(n),C(t),x(t)?t.split("").filter((function(){return Math.random()<n})).join(""):t.filter((function(){return Math.random()<n}))},validate:function(e){return k(2,e)}},"rand-nth!":{evaluate:function(e){var n=e[0];if(C(n),0===n.length)return null;var t=Math.floor(Math.random()*n.length);return x(n)?K(n.split("")[t]):K(n[t])},validate:function(e){return k(1,e)}},shuffle:{evaluate:function(e){var n=e[0];C(n);for(var t,r,u=x(n)?a([],n.split("")):a([],n),i=u.length;i;)i-=1,r=Math.floor(Math.random()*i),t=K(u[i]),u[i]=K(u[r]),u[r]=t;return x(n)?u.join(""):u},validate:function(e){return k(1,e)}},distinct:{evaluate:function(e){var n=e[0];return C(n),Array.isArray(n)?Array.from(new Set(n)):Array.from(new Set(n.split(""))).join("")},validate:function(e){return k(1,e)}},remove:{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;return T(r),C(a),Array.isArray(a)?a.filter((function(e){return!u(r,[e],n)})):a.split("").filter((function(e){return!u(r,[e],n)})).join("")},validate:function(e){return k(2,e)}},"split-at":{evaluate:function(e){var n=e[0],t=e[1];h(n);var r=H(n);return C(t),[t.slice(0,r),t.slice(r)]},validate:function(e){return k(2,e)}},"split-with":{evaluate:function(e,n,t){var r=e[0],a=e[1],u=t.executeFunction;T(r),C(a);var i=Array.isArray(a),o=(i?a:a.split("")).findIndex((function(e){return!u(r,[e],n)}));return-1===o?[a,i?[]:""]:[a.slice(0,o),a.slice(o)]},validate:function(e){return k(2,e)}}},Me={array:{evaluate:function(e){return e}},range:{evaluate:function(e){var n,t,r,a=e[0],u=e[1],i=e[2];h(a),1===e.length?(n=0,r=(t=a)>=0?1:-1):2===e.length?(h(u),r=(t=u)>=(n=a)?1:-1):(h(u),h(i),r=i,(t=u)>(n=a)?function(e){if(h(e),e<=0)throw TypeError("Expected positive number, got "+e)}(r):t<n?function(e){if(h(e),e>=0)throw TypeError("Expected negative number, got "+e)}(r):function(e){if(h(e),0===e)throw TypeError("Expected non zero value")}(r));for(var o=[],l=n;r<0?l>t:l<t;l+=r)o.push(l);return o},validate:function(e){return k({min:1,max:3},e)}},repeat:{evaluate:function(e){var n=e[0],t=e[1];g(n);for(var r=[],a=0;a<n;a+=1)r.push(t);return r},validate:function(e){return k(2,e)}},flatten:{evaluate:function(e){var n=e[0];return B(n)?n.flat(Number.POSITIVE_INFINITY):[]},validate:function(e){return k(1,e)}},mapcat:{evaluate:function(e,n,t){e.slice(1).forEach((function(e){R(e)}));var r=Ne(e,n,t);return R(r),r.flat(1)},validate:function(e){return k({min:2},e)}}},ke={inc:{evaluate:function(e){var n=e[0];return P(n),n+1},validate:function(e){return k(1,e)}},dec:{evaluate:function(e){var n=e[0];return P(n),n-1},validate:function(e){return k(1,e)}},"+":{evaluate:function(e){return e.reduce((function(e,n){return P(n),e+n}),0)}},"*":{evaluate:function(e){return e.reduce((function(e,n){return P(n),e*n}),1)}},"/":{evaluate:function(e){if(0===e.length)return 1;var n=e[0],t=e.slice(1);return P(n),0===t.length?(P(n),1/n):t.reduce((function(e,n){return P(n),e/n}),n)}},"-":{evaluate:function(e){var n=e[0],t=e.slice(1);return n?(P(n),0===t.length?-n:t.reduce((function(e,n){return P(n),e-n}),n)):0}},quot:{evaluate:function(e){var n=e[0],t=e[1];return P(n),P(t),Math.trunc(n/t)},validate:function(e){return k(2,e)}},mod:{evaluate:function(e){var n=e[0],t=e[1];return P(n),P(t),n-t*Math.floor(n/t)},validate:function(e){return k(2,e)}},rem:{evaluate:function(e){var n=e[0],t=e[1];return P(n),P(t),n-t*Math.trunc(n/t)},validate:function(e){return k(2,e)}},sqrt:{evaluate:function(e){var n=e[0];return P(n),Math.sqrt(n)},validate:function(e){return k(1,e)}},cbrt:{evaluate:function(e){var n=e[0];return P(n),Math.cbrt(n)},validate:function(e){return k(1,e)}},pow:{evaluate:function(e){var n=e[0],t=e[1];return P(n),P(t),Math.pow(n,t)},validate:function(e){return k(2,e)}},round:{evaluate:function(e){var n=e[0],t=e[1];if(P(n),1===e.length||0===t)return Math.round(n);g(t);var r=Math.pow(10,t);return Math.round(n*r)/r},validate:function(e){return k({min:1,max:2},e)}},trunc:{evaluate:function(e){var n=e[0];return P(n),Math.trunc(n)},validate:function(e){return k(1,e)}},floor:{evaluate:function(e){var n=e[0];return P(n),Math.floor(n)},validate:function(e){return k(1,e)}},ceil:{evaluate:function(e){var n=e[0];return P(n),Math.ceil(n)},validate:function(e){return k(1,e)}},"rand!":{evaluate:function(e){var n=1===e.length?e[0]:1;return P(n),Math.random()*n},validate:function(e){return k({min:0,max:1},e)}},"rand-int!":{evaluate:function(e){var n=e[0];return P(n),Math.floor(Math.random()*Math.abs(n))*Math.sign(n)},validate:function(e){return k(1,e)}},min:{evaluate:function(e){var n=e[0],t=e.slice(1);return P(n),0===t.length?n:t.reduce((function(e,n){return P(n),Math.min(e,n)}),n)},validate:function(e){return k({min:1},e)}},max:{evaluate:function(e){var n=e[0],t=e.slice(1);return P(n),0===t.length?n:t.reduce((function(e,n){return P(n),Math.max(e,n)}),n)},validate:function(e){return k({min:1},e)}},abs:{evaluate:function(e){var n=e[0];return P(n),Math.abs(n)},validate:function(e){return k(1,e)}},sign:{evaluate:function(e){var n=e[0];return P(n),Math.sign(n)},validate:function(e){return k(1,e)}},"max-safe-integer":{evaluate:function(){return Number.MAX_SAFE_INTEGER},validate:function(e){return k(0,e)}},"min-safe-integer":{evaluate:function(){return Number.MIN_SAFE_INTEGER},validate:function(e){return k(0,e)}},"max-value":{evaluate:function(){return Number.MAX_VALUE},validate:function(e){return k(0,e)}},"min-value":{evaluate:function(){return Number.MIN_VALUE},validate:function(e){return k(0,e)}},epsilon:{evaluate:function(){return Number.EPSILON},validate:function(e){return k(0,e)}},infinity:{evaluate:function(){return Number.POSITIVE_INFINITY},validate:function(e){return k(0,e)}},"-infinity":{evaluate:function(){return Number.NEGATIVE_INFINITY},validate:function(e){return k(0,e)}},nan:{evaluate:function(){return Number.NaN},validate:function(e){return k(0,e)}},e:{evaluate:function(){return Math.E},validate:function(e){return k(0,e)}},pi:{evaluate:function(){return Math.PI},validate:function(e){return k(0,e)}},exp:{evaluate:function(e){var n=e[0];return P(n),Math.exp(n)},validate:function(e){return k(1,e)}},log:{evaluate:function(e){var n=e[0];return P(n),Math.log(n)},validate:function(e){return k(1,e)}},log2:{evaluate:function(e){var n=e[0];return P(n),Math.log2(n)},validate:function(e){return k(1,e)}},log10:{evaluate:function(e){var n=e[0];return P(n),Math.log10(n)},validate:function(e){return k(1,e)}},sin:{evaluate:function(e){var n=e[0];return P(n),Math.sin(n)},validate:function(e){return k(1,e)}},asin:{evaluate:function(e){var n=e[0];return P(n),Math.asin(n)},validate:function(e){return k(1,e)}},sinh:{evaluate:function(e){var n=e[0];return P(n),Math.sinh(n)},validate:function(e){return k(1,e)}},asinh:{evaluate:function(e){var n=e[0];return P(n),Math.asinh(n)},validate:function(e){return k(1,e)}},cos:{evaluate:function(e){var n=e[0];return P(n),Math.cos(n)},validate:function(e){return k(1,e)}},acos:{evaluate:function(e){var n=e[0];return P(n),Math.acos(n)},validate:function(e){return k(1,e)}},cosh:{evaluate:function(e){var n=e[0];return P(n),Math.cosh(n)},validate:function(e){return k(1,e)}},acosh:{evaluate:function(e){var n=e[0];return P(n),Math.acosh(n)},validate:function(e){return k(1,e)}},tan:{evaluate:function(e){var n=e[0];return P(n),Math.tan(n)},validate:function(e){return k(1,e)}},atan:{evaluate:function(e){var n=e[0];return P(n),Math.atan(n)},validate:function(e){return k(1,e)}},tanh:{evaluate:function(e){var n=e[0];return P(n),Math.tanh(n)},validate:function(e){return k(1,e)}},atanh:{evaluate:function(e){var n=e[0];return P(n),Math.atanh(n)},validate:function(e){return k(1,e)}}},Oe=/[[.]/;function Se(e,n){for(var t=0,r=Te(n);t<r.length;t++){var a=r[t];try{e=K(e[a])}catch(e){return null}}return e}function Te(e){if(!e)return[];var n=Oe.exec(e);if(!n)return[e];if(n.index>0)return a([e.substring(0,n.index)],Te(e.substring(n.index)));if("."===e[0]){if(e.length<2)throw Error("Ill formed path: "+e);return Te(e.substring(1))}var t=function(e){var n=Ie.exec(e)||Fe.exec(e);if(n){return[n[0].length,n[1]]}var t=Pe.exec(e);if(t){return[t[0].length,Number(t[1])]}throw Error("Ill formed path: "+e)}(e),r=t[0],u=t[1];if(e.length>r&&"."!==e[r]&&"["!==e[r])throw Error("Ill formed path: "+e);return a([u],Te(e.substring(r)))}var Ie=/^\[\s*'(.*)'\s*\]/,Fe=/^\[\s*"(.*)"\s*\]/,Pe=/^\[\s*(\d+)\s*\]/;var Re={"not=":{evaluate:function(e){for(var n=0;n<e.length-1;n+=1)for(var t=n+1;t<e.length;t+=1)if(e[n]===e[t])return!1;return!0},validate:function(e){return k({min:1},e)}},"=":{evaluate:function(e){for(var n=e[0],t=0,r=e.slice(1);t<r.length;t++){if(r[t]!==n)return!1}return!0},validate:function(e){return k({min:1},e)}},"equal?":{evaluate:function(e){var n=e[0],t=e[1];return X(p(n),p(t))},validate:function(e){return k({min:1},e)}},">":{evaluate:function(e){for(var n=e[0],t=0,r=e.slice(1);t<r.length;t++){var a=r[t];if(W(n,a)<=0)return!1;n=a}return!0},validate:function(e){return k({min:1},e)}},"<":{evaluate:function(e){for(var n=e[0],t=0,r=e.slice(1);t<r.length;t++){var a=r[t];if(W(n,a)>=0)return!1;n=a}return!0},validate:function(e){return k({min:1},e)}},">=":{evaluate:function(e){for(var n=e[0],t=0,r=e.slice(1);t<r.length;t++){var a=r[t];if(W(n,a)<0)return!1;n=a}return!0},validate:function(e){return k({min:1},e)}},"<=":{evaluate:function(e){for(var n=e[0],t=0,r=e.slice(1);t<r.length;t++){var a=r[t];if(W(n,a)>0)return!1;n=a}return!0},validate:function(e){return k({min:1},e)}},"get-path":{evaluate:function(e){var n=e[0],t=e[1];return function(e){if((null===e||"object"!=typeof e||Array.isArray(e)||e instanceof RegExp||S(e))&&!Array.isArray(e))throw TypeError("Expected object or array, got: "+e+' type="'+typeof e+'"')}(n),E(t),Se(n,t)},validate:function(e){return k(2,e)}},not:{evaluate:function(e){return!e[0]},validate:function(e){return k(1,e)}},"inst-ms":{evaluate:function(){return Date.now()},validate:function(e){return k(0,e)}},"write!":{evaluate:function(e){return console.log.apply(console,e),e.length>0?p(e[e.length-1]):null}},"debug!":{evaluate:function(e,n){return 0===e.length?(console.warn("*** LISPISH DEBUG ***\n"+function(e){return a([],e).reverse().reduce((function(e,n,t){return e+"Context "+t+(0===t?" - Import context":1===t?" - Global context":"")+"\n"+function(e){if(0===Object.keys(e).length)return"  <empty>\n";var n=Math.max.apply(Math,Object.keys(e).map((function(e){return e.length})));return Object.entries(e).reduce((function(e,t){return e+"  "+(""+t[0]).padEnd(n+2," ")+function(e){var n=e.value,t=n.name;if(S(n))return t?"<"+n.type+" function "+t+">":"<"+n.type+" function Î»>";return JSON.stringify(e.value)}(t[1])+"\n"}),"")}(n)+"\n"}),"")}(n)+"\n"),null):(console.warn("*** LISPISH DEBUG ***\n"+JSON.stringify(e[0],null,2)+"\n"),p(e[0]))},validate:function(e){return k({max:1},e)}},boolean:{evaluate:function(e){return!!e[0]},validate:function(e){return k(1,e)}},compare:{evaluate:function(e){return W(e[0],e[1])},validate:function(e){return k(2,e)}},assert:{evaluate:function(e){var n=e[0],t=2===e.length?e[1]:""+n;if(E(t),!n)throw new o(t);return p(n)},validate:function(e){return k({min:1,max:2},e)}},"lispish-version":{evaluate:function(){return"0.1.52"},validate:function(e){return k(0,e)}}};var _e={object:{evaluate:function(e){for(var n={},t=0;t<e.length;t+=2){var r=e[t],a=e[t+1];E(r),n[r]=a}return n},validate:function(e){return O(e)}},keys:{evaluate:function(e){var n=e[0];return V(n),Object.keys(n)},validate:function(e){return k(1,e)}},vals:{evaluate:function(e){var n=e[0];return V(n),Object.values(n)},validate:function(e){return k(1,e)}},entries:{evaluate:function(e){var n=e[0];return V(n),Object.entries(n)},validate:function(e){return k(1,e)}},find:{evaluate:function(e){var n=e[0],t=e[1];return V(n),E(t),G(n,t)?[t,n[t]]:null},validate:function(e){return k(2,e)}},dissoc:{evaluate:function(e){var n=e[0],t=e[1];V(n),E(t);var r=K(n[t]);return delete n[t],r},validate:function(e){return k(2,e)}},merge:{evaluate:function(e){var n=e[0],t=e.slice(1);return V(n),t.reduce((function(e,n){return V(n),r(r({},e),n)}),r({},n))},validate:function(e){return k({min:1},e)}},zipmap:{evaluate:function(e){var n=e[0],t=e[1];I(n),R(t);for(var r=Math.min(n.length,t.length),a={},u=0;u<r;u+=1){a[d(n[u])]=K(t[u])}return a},validate:function(e){return k(2,e)}},"select-keys":{evaluate:function(e){var n=e[0],t=e[1];return I(t),V(n),t.reduce((function(e,t){return G(n,t)&&(e[t]=K(n[t])),e}),{})},validate:function(e){return k(2,e)}}},qe={"function?":{evaluate:function(e){return S(e[0])},validate:function(e){return k(1,e)}},"string?":{evaluate:function(e){return"string"==typeof e[0]},validate:function(e){return k(1,e)}},"number?":{evaluate:function(e){return"number"==typeof e[0]},validate:function(e){return k(1,e)}},"integer?":{evaluate:function(e){var n=e[0];return"number"==typeof n&&Number.isInteger(n)},validate:function(e){return k(1,e)}},"boolean?":{evaluate:function(e){return"boolean"==typeof e[0]},validate:function(e){return k(1,e)}},"nil?":{evaluate:function(e){var n=e[0];return null==n},validate:function(e){return k(1,e)}},"zero?":{evaluate:function(e){var n=e[0];return h(n),0===n},validate:function(e){return k(1,e)}},"pos?":{evaluate:function(e){var n=e[0];return h(n),n>0},validate:function(e){return k(1,e)}},"neg?":{evaluate:function(e){var n=e[0];return h(n),n<0},validate:function(e){return k(1,e)}},"even?":{evaluate:function(e){var n=e[0];return h(n),n%2==0},validate:function(e){return k(1,e)}},"odd?":{evaluate:function(e){var n=e[0];return h(n),Number.isInteger(n)&&n%2!=0},validate:function(e){return k(1,e)}},"array?":{evaluate:function(e){return B(e[0])},validate:function(e){return k(1,e)}},"coll?":{evaluate:function(e){return L(e[0])},validate:function(e){return k(1,e)}},"seq?":{evaluate:function(e){return D(e[0])},validate:function(e){return k(1,e)}},"object?":{evaluate:function(e){return U(e[0])},validate:function(e){return k(1,e)}},"regexp?":{evaluate:function(e){var n=e[0];return null!==n&&!Array.isArray(n)&&"object"==typeof n&&n instanceof RegExp},validate:function(e){return k(1,e)}},"finite?":{evaluate:function(e){var n=e[0];return P(n),Number.isFinite(n)},validate:function(e){return k(1,e)}},"nan?":{evaluate:function(e){var n=e[0];return P(n),Number.isNaN(n)},validate:function(e){return k(1,e)}},"positive-infinity?":{evaluate:function(e){var n=e[0];return P(n),n===Number.POSITIVE_INFINITY},validate:function(e){return k(1,e)}},"negative-infinity?":{evaluate:function(e){var n=e[0];return P(n),n===Number.NEGATIVE_INFINITY},validate:function(e){return k(1,e)}},"true?":{evaluate:function(e){return!0===e[0]},validate:function(e){return k(1,e)}},"false?":{evaluate:function(e){return!1===e[0]},validate:function(e){return k(1,e)}}},Ce={regexp:{evaluate:function(e){var n=e[0],t=e[1];return E(n),1===e.length?new RegExp(n):(E(t),new RegExp(n,t))},validate:function(e){return k({min:1,max:2},e)}},match:{evaluate:function(e){var n=e[0],t=e[1];M(n),E(t);var r=n.exec(t);return r?a([],r):null},validate:function(e){return k(2,e)}},replace:{evaluate:function(e){var n=e[0],t=e[1],r=e[2];return E(n),M(t),E(r),n.replace(t,r)},validate:function(e){return k(3,e)}}},Ve={subs:{evaluate:function(e){var n=e[0],t=e[1],r=e[2];return E(n),g(t),void 0===r?n.substring(t):(b(r,t),n.substring(t,r))},validate:function(e){return k({min:2,max:3},e)}},"string-repeat":{evaluate:function(e){var n=e[0],t=e[1];return E(n),g(t),n.repeat(t)},validate:function(e){return k(2,e)}},str:{evaluate:function(e){return e.reduce((function(e,n){return e+(null==n?"":U(n)||Array.isArray(n)?JSON.stringify(n):""+n)}),"")}},"string-to-number":{evaluate:function(e){var n=e[0];E(n);var t=Number(n);if(Number.isNaN(t))throw Error("Could not convert '"+n+"' to a number");return t},validate:function(e){return k(1,e)}},"number-to-string":{evaluate:function(e){var n=e[0],t=e[1];if(h(n),1===e.length)return""+n;if(h(t),2!==t&&8!==t&&10!==t&&16!==t)throw Error('Expected "number-to-string" base argument to be 2, 8, 10 or 16, got: '+t);return 10===t?""+n:(g(n),Number(n).toString(t))},validate:function(e){return k({min:1,max:2},e)}},"from-char-code":{evaluate:function(e){var n=e[0];h(n);var t=H(n);return String.fromCodePoint(t)},validate:function(e){return k(1,e)}},"to-char-code":{evaluate:function(e){var n=e[0];return function(e){if(E(e),0===e.length)throw TypeError("Expected non empty string, got: "+e+' type="'+typeof e+'"')}(n),d(n.codePointAt(0))},validate:function(e){return k(1,e)}},"lower-case":{evaluate:function(e){var n=e[0];return E(n),n.toLowerCase()},validate:function(e){return k(1,e)}},"upper-case":{evaluate:function(e){var n=e[0];return E(n),n.toUpperCase()},validate:function(e){return k(1,e)}},trim:{evaluate:function(e){var n=e[0];return E(n),n.trim()},validate:function(e){return k(1,e)}},"trim-left":{evaluate:function(e){var n=e[0];return E(n),n.replace(/^\s+/,"")},validate:function(e){return k(1,e)}},"trim-right":{evaluate:function(e){var n=e[0];return E(n),n.replace(/\s+$/,"")},validate:function(e){return k(1,e)}},join:{evaluate:function(e){var n=e[0],t=e[1];return R(n),n.forEach((function(e){return E(e)})),E(t),n.join(t)},validate:function(e){return k(2,e)}},split:{evaluate:function(e){var n=e[0],t=e[1],r=e[2];return E(n),function(e){if(!(e instanceof RegExp||"string"==typeof e))throw TypeError("Expected RegExp or string, got: "+e+' type="'+typeof e+'"')}(t),void 0!==r&&g(r),n.split(t,r)},validate:function(e){return k({min:2,max:3},e)}},"pad-left":{evaluate:function(e){var n=e[0],t=e[1],r=e[2];return E(n),y(t),void 0!==r&&E(r),n.padStart(t,r)},validate:function(e){return k({min:2,max:3},e)}},"pad-right":{evaluate:function(e){var n=e[0],t=e[1],r=e[2];return E(n),y(t),void 0!==r&&E(r),n.padEnd(t,r)},validate:function(e){return k({min:2,max:3},e)}},template:{evaluate:function(e){var n=e[0],t=e.slice(1);E(n);var r=n.split("||||");if(1===r.length)return I(t),Be(r[0],t);if(2===r.length){var u=t[0];g(u);var i=a([""+u],t.slice(1));return Be(1===u?r[0]:r[1],i)}throw Error('Invalid template string, only one "||||" separator allowed')},validate:function(e){return k({min:1,max:10},e)}}},Ue=/\$\$/g;function Be(e,n){for(var t=0;t<9;t+=1){var r=new RegExp("(?<=^|[^$]|\\$\\$)\\$"+(t+1),"g");if(r.test(e)){var a=n[t];E(a),e=e.replace(r,a)}}return e.replace(Ue,"$")}var De={apply:{evaluate:function(e,n,t){var r=e[0],u=e.slice(1),i=t.executeFunction;T(r);var o=u[u.length-1];return R(o),i(r,a(a([],u.slice(0,-1)),o),n)},validate:function(e){return k({min:2},e)}},identity:{evaluate:function(e){return K(e[0])},validate:function(e){return k(1,e)}},partial:{evaluate:function(e){var n,t=e[0],r=e.slice(1);return(n={})[c]=!0,n.type="partial",n.fn=K(t),n.params=r,n},validate:function(e){return k({min:1},e)}},comp:{evaluate:function(e){var n;if(e.length>1){var t=e[e.length-1];B(t)&&(e=a(a([],e.slice(0,-1)),t))}return(n={})[c]=!0,n.type="comp",n.fns=e,n}},constantly:{evaluate:function(e){var n,t=e[0];return(n={})[c]=!0,n.type="constantly",n.value=K(t),n},validate:function(e){return k(1,e)}},juxt:{evaluate:function(e){var n;return(n={})[c]=!0,n.type="juxt",n.fns=e,n},validate:function(e){return k({min:1},e)}},complement:{evaluate:function(e){var n,t=e[0];return(n={})[c]=!0,n.type="complement",n.fn=K(t),n},validate:function(e){return k(1,e)}},"every-pred":{evaluate:function(e){var n;return(n={})[c]=!0,n.type="every-pred",n.fns=e,n},validate:function(e){return k({min:1},e)}},"some-pred":{evaluate:function(e){var n;return(n={})[c]=!0,n.type="some-pred",n.fns=e,n},validate:function(e){return k({min:1},e)}}},Le=r(r(r(r(r(r(r(r(r(r(r({},{"bit-shift-left":{evaluate:function(e){var n=e[0],t=e[1];return y(n),g(t),n<<t},validate:function(e){return k(2,e)}},"bit-shift-right":{evaluate:function(e){var n=e[0],t=e[1];return y(n),g(t),n>>t},validate:function(e){return k(2,e)}},"bit-not":{evaluate:function(e){var n=e[0];return y(n),~n},validate:function(e){return k(1,e)}},"bit-and":{evaluate:function(e){var n=e[0],t=e.slice(1);return y(n),t.reduce((function(e,n){return y(n),e&n}),n)},validate:function(e){return k({min:2},e)}},"bit-and-not":{evaluate:function(e){var n=e[0],t=e.slice(1);return y(n),t.reduce((function(e,n){return y(n),e&~n}),n)},validate:function(e){return k({min:2},e)}},"bit-or":{evaluate:function(e){var n=e[0],t=e.slice(1);return y(n),t.reduce((function(e,n){return y(n),e|n}),n)},validate:function(e){return k({min:2},e)}},"bit-xor":{evaluate:function(e){var n=e[0],t=e.slice(1);return y(n),t.reduce((function(e,n){return y(n),e^n}),n)},validate:function(e){return k({min:2},e)}},"bit-flip":{evaluate:function(e){var n=e[0],t=e[1];return y(n),g(t),n^1<<t},validate:function(e){return k(2,e)}},"bit-set":{evaluate:function(e){var n=e[0],t=e[1];return y(n),g(t),n|1<<t},validate:function(e){return k(2,e)}},"bit-clear":{evaluate:function(e){var n=e[0],t=e[1];return y(n),g(t),n&~(1<<t)},validate:function(e){return k(2,e)}},"bit-test":{evaluate:function(e){var n=e[0],t=e[1];return y(n),g(t),!!(n&1<<t)},validate:function(e){return k(2,e)}}}),Ae),Me),je),ke),Re),_e),qe),Ce),Ve),De),$e={def:me,defs:he,and:{parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"and",params:r[1]}]},evaluate:function(e,n,t){for(var r=t.evaluateAstNode,a=!0,u=0,i=e.params;u<i.length;u++){if(!(a=r(i[u],n)))break}return a}},cond:Z,defn:ae,defns:ue,if:oe,"if-not":le,"if-let":fe,"when-let":ce,"when-not":ve,"when-first":se,fn:ie,let:pe,or:{parse:function(e,n,t){var r=(0,t.parseTokens)(e,n);return[r[0]+1,{type:"SpecialExpression",name:"or",params:r[1]}]},evaluate:function(e,n,t){for(var r=t.evaluateAstNode,a=!1,u=0,i=e.params;u<i.length;u++){if(a=r(i[u],n))break}return a}},do:de,throw:ge,try:ye,when:be,recur:xe,loop:Ee,"time!":we};Object.keys($e).forEach((function(e){if(Le[e])throw Error("Expression "+e+" is defined as both a normal expression and a special expression")}));var ze={normalExpressions:Le,specialExpressions:$e},Ge=Object.keys(Le),Ye=Object.keys($e),Je={"user-defined":function(e,n,t,i){for(var o,l,f,c=i.evaluateAstNode,v=e.arguments,s=v.mandatoryArguments.length,p=v.optionalArguments.length,m=v.restArgument?null:s+p;;){var h=r({},e.functionContext);if(n.length<v.mandatoryArguments.length)throw Error("Function "+(null!==(o=e.name)&&void 0!==o?o:"(fn)")+" requires at least "+v.mandatoryArguments.length+" arguments. Got "+n.length);if(null!==m&&n.length>m)throw Error('Function "'+(null!==(l=e.name)&&void 0!==l?l:"Î»")+'" requires at most '+m+" arguments. Got "+n.length);for(var g=Math.max(n.length,v.mandatoryArguments.length+v.optionalArguments.length),y=[],b=0;b<g;b+=1)if(b<s){var x=K(n[b]);h[w(v.mandatoryArguments[b])]={value:x}}else if(b<s+p){var E=d(v.optionalArguments[b-s]);x=b<n.length?K(n[b]):null!==(f=E.defaultValue)&&void 0!==f?f:null;h[E.name]={value:x}}else y.push(K(n[b]));v.restArgument&&(h[v.restArgument]={value:y});try{for(var A=null,N=0,j=e.body;N<j.length;N++){A=c(j[N],a([h],t))}return A}catch(e){if(e instanceof u){n=e.params;continue}throw e}}},partial:function(e,n,t,r){return(0,r.executeFunction)(e.fn,a(a([],e.params),n),t)},comp:function(e,n,t,r){var a=r.executeFunction,u=e.fns;if(0===u.length){if(1!==n.length)throw Error("(comp) expects one argument, got "+n.length);return p(n[0])}return p(u.reduceRight((function(e,n){return[a(K(n),e,t)]}),n)[0])},constantly:function(e){return e.value},juxt:function(e,n,t,r){var a=r.executeFunction;return e.fns.map((function(e){return a(K(e),n,t)}))},complement:function(e,n,t,r){return!(0,r.executeFunction)(e.fn,n,t)},"every-pred":function(e,n,t,r){for(var a=r.executeFunction,u=0,i=e.fns;u<i.length;u++)for(var o=i[u],l=0,f=n;l<f.length;l++){var c=f[l];if(!a(K(o),[c],t))return!1}return!0},"some-pred":function(e,n,t,r){for(var a=r.executeFunction,u=0,i=e.fns;u<i.length;u++)for(var o=i[u],l=0,f=n;l<f.length;l++){var c=f[l];if(a(K(o),[c],t))return!0}return!1},builtin:function(e,n,t,r){var a=r.executeFunction;return d(Le[e.name]).evaluate(n,t,{executeFunction:a})}};function We(e,n,t){for(var r,a=[n,t],u=0,i=e.body;u<i.length;u++){var o=i[u];r=Xe(o,a)}return r}var Xe=function(e,n){switch(e.type){case"Number":case"String":return function(e){return e.value}(e);case"Name":return function(e,n){for(var t,r=e.value,a=0,u=n;a<u.length;a++){var i=u[a][r];if(i)return i.value}if(ze.normalExpressions[r]){return(t={})[c]=!0,t.type="builtin",t.name=r,t}throw Error("Undefined identifier "+r)}(e,n);case"ReservedName":return function(e){return d(Q[e.value]).value}(e);case"NormalExpression":return function(e,n){var t,r=e.params.map((function(e){return Xe(e,n)}));if(function(e){return"string"==typeof e.name}(e)){for(var a=0,u=n;a<u.length;a++){if(void 0!==(i=null===(t=u[a][e.name])||void 0===t?void 0:t.value))try{return He(i,r,n)}catch(e){continue}}return function(e,n,t){return(0,d(ze.normalExpressions[e.name]).evaluate)(n,t,{executeFunction:He})}(e,r,n)}var i=Xe(e.expression,n);return He(i,r,n)}(e,n);case"SpecialExpression":return function(e,n){return(0,d(ze.specialExpressions[e.name]).evaluate)(e,n,{evaluateAstNode:Xe,builtin:ze})}(e,n);default:throw Error(e.type+"-node cannot be evaluated")}};var He=function(e,n,t){if(S(e))return Je[e.type](e,n,t,{evaluateAstNode:Xe,executeFunction:He});if(Array.isArray(e))return function(e,n){if(1!==n.length)throw Error("Array as function requires one non negative integer parameter");var t=n[0];return g(t),K(e[t])}(e,n);if(U(e))return function(e,n){if(1!==n.length)throw Error("Object as function requires one string parameter");var t=n[0];return E(t),K(e[t])}(e,n);if(x(e))return function(e,n){if(1!==n.length)throw Error("String as function requires one Obj parameter");var t=K(n[0]);if(U(t))return K(t[e]);if(z(t))return K(e[t]);throw Error("string as function expects Obj or integer parameter, got "+t)}(e,n);if($(e))return function(e,n){if(y(e),1!==n.length)throw Error("String as function requires one Arr parameter");var t=n[0];return C(t),K(t[e])}(e,n);throw Error("Expected function, got "+e)};var Ke=function(e,n){for(var t,r,a=d(e[n]),u=[];"paren"!==a.type||")"!==a.value&&"]"!==a.value;)n=(t=un(e,n))[0],r=t[1],u.push(r),a=d(e[n]);return[n,u]},Ze=function(e,n){var t=d(e[n+=1]);return"name"===t.type&&ze.specialExpressions[t.value]?an(e,n):rn(e,n)},Qe=/^%([1-9][0-9]?$)/,en=function(e,n){var t=d(e[n]);if("name"===t.type)return[n+1,{type:"Argument",name:t.value}];if("paren"===t.type&&"("===t.value){if("name"!==(t=d(e[n+=1])).type)throw new l("name",t);var r=t.value,a=un(e,n+=1),u=a[0],i=a[1];if("paren"!==(t=d(e[u])).type||")"!==t.value)throw new l(")",t);return[u+1,{type:"Argument",name:r,defaultValue:i}]}if("modifier"===t.type)return[n+1,{type:"Modifier",value:t.value}];throw new l('"(", name or modifier',t)},nn=function(e,n){var t,r=d(e[n]);if("paren"!==r.type||"["!==r.value)throw new l("[",r);r=d(e[n+=1]);for(var a,u=[];"paren"!==r.type||"]"!==r.value;)n=(t=tn(e,n))[0],a=t[1],u.push(a),r=d(e[n]);return[n+=1,u]};function tn(e,n){var t,r=d(e[n]);if("name"!==r.type)throw Error("Expected name node in binding, got "+r.type+" value="+r.value);var a=r.value;return r=d(e[n+=1]),[n=(t=un(e,n))[0],{type:"Binding",name:a,value:t[1]}]}var rn=function(e,n){var t,r,a,u=un(e,n),i=u[0],o=u[1];if(n=(t=Ke(e,i))[0],a=t[1],n+=1,function(e){return"NormalExpression"===e.type||"SpecialExpression"===e.type||"Number"===e.type||"String"===e.type}(o))return[n,{type:"NormalExpression",expression:o,params:a}];s(o);var l={type:"NormalExpression",name:o.value,params:a},f=ze.normalExpressions[l.name];return f&&(null===(r=f.validate)||void 0===r||r.call(f,l)),[n,l]},an=function(e,n){var t=d(e[n]).value;n+=1;var r=d(ze.specialExpressions[t]),a=r.parse,u=r.validate,i=a(e,n,{parseExpression:Ze,parseTokens:Ke,parseToken:un,parseBindings:nn,parseArgument:en}),o=i[0],l=i[1];return null==u||u(l),[o,l]},un=function(e,n){var t=d(e[n]),r=void 0;switch(t.type){case"number":r=function(e,n){var t=d(e[n]);return[n+1,{type:"Number",value:Number(t.value)}]}(e,n);break;case"string":r=function(e,n){return[n+1,{type:"String",value:d(e[n]).value}]}(e,n);break;case"name":r=function(e,n){return[n+1,{type:"Name",value:d(e[n]).value}]}(e,n);break;case"reservedName":r=function(e,n){return[n+1,{type:"ReservedName",value:d(e[n]).value}]}(e,n);break;case"paren":"("===t.value?r=Ze(e,n):"["===t.value?r=function(e,n){for(var t,r,a=d(e[n+=1]),u=[];"paren"!==a.type||"]"!==a.value;)n=(t=un(e,n))[0],r=t[1],u.push(r),a=d(e[n]);return[n+=1,{type:"NormalExpression",name:"array",params:u}]}(e,n):"{"===t.value&&(r=function(e,n){for(var t,r,a=d(e[n+=1]),u=[];"paren"!==a.type||"}"!==a.value;)n=(t=un(e,n))[0],r=t[1],u.push(r),a=d(e[n]);n+=1;var i={type:"NormalExpression",name:"object",params:u};return O(i),[n,i]}(e,n));break;case"regexpShorthand":r=function(e,n){return[n+1,{type:"NormalExpression",name:"regexp",params:[{type:"String",value:d(e[n]).value}]}]}(e,n);break;case"fnShorthand":r=function(e,n){for(var t=rn(e,n+=2),r=t[0],a=t[1],u=0,i=n+1;i<r-1;i+=1){var o=d(e[i]);if("name"===o.type){var l=Qe.exec(o.value);if(l&&(u=Math.max(u,Number(l[1])))>20)throw Error("Can't specify more than 20 arguments")}if("fnShorthand"===o.type)throw Error("Nested shortcut functions are not allowed")}for(var f=[],c=1;c<=u;c+=1)f.push("%"+c);return[r,{type:"SpecialExpression",name:"fn",params:[],arguments:{bindings:[],mandatoryArguments:f,optionalArguments:[]},body:[a]}]}(e,n)}if(!r)throw SyntaxError("Unrecognized token: "+t.type+" value="+t.value);return r};var on=/[%0-9a-zA-Z_^?=!$%<>.+*/-]/,ln=/\s|,/,fn=function(e,n){if('"'!==e[n])return[0,void 0];for(var t="",r=1,a=e[n+r],u=!1;'"'!==a||u;){if(void 0===a)throw new SyntaxError("Unclosed string at position "+n);u?(u=!1,'"'===a||"\\"===a||(t+="\\"),t+=a):"\\"===a?u=!0:t+=a,a=e[n+(r+=1)]}return[r+1,{type:"string",value:t}]},cn=/\s|[)\]},]/,vn=/[0-9]/,sn=/[0-7]/,pn=/[0-9a-fA-F]/,dn=/[0-1]/,mn=/[0-9.-]/;function hn(e,n,t,r){return n===t[r]?[1,{type:e,value:n}]:[0,void 0]}var gn=[function(e,n){if(";"===e[n]){for(var t=1;"\n"!==e[n+t]&&n+t<e.length;)t+=1;return"\n"===e[n+t]&&n+t<e.length&&(t+=1),[t,void 0]}return[0,void 0]},function(e,n){var t;return ln.test(null!==(t=e[n])&&void 0!==t?t:"")?[1,void 0]:[0,void 0]},function(e,n){return hn("paren","(",e,n)},function(e,n){return hn("paren",")",e,n)},function(e,n){return hn("paren","[",e,n)},function(e,n){return hn("paren","]",e,n)},function(e,n){return hn("paren","{",e,n)},function(e,n){return hn("paren","}",e,n)},fn,function(e,n){var t="decimal",r=e[n];if(void 0===r)return[0,void 0];var a,u="."===r;if(!mn.test(r))return[0,void 0];for(a=n+1;a<e.length;a+=1){var i=d(e[a]);if(cn.test(i))break;if(a===n+1&&"0"===r){if("b"===i||"B"===i){t="binary";continue}if("o"===i||"O"===i){t="octal";continue}if("x"===i||"X"===i){t="hex";continue}}if("decimal"===t&&u){if(!vn.test(i))return[0,void 0]}else if("binary"===t){if(!dn.test(i))return[0,void 0]}else if("octal"===t){if(!sn.test(i))return[0,void 0]}else if("hex"===t){if(!pn.test(i))return[0,void 0]}else{if("."===i){u=!0;continue}if(!vn.test(i))return[0,void 0]}}var o=a-n,l=e.substring(n,a);return"decimal"!==t&&o<=2||"."===l||"-"===l?[0,void 0]:[o,{type:"number",value:l}]},function(e,n){for(var t=0,r=Object.keys(Q);t<r.length;t++){var a=r[t],u=a.length,i=e[n+u];if((!i||!on.test(i))&&e.substr(n,u)===a)return[u,{type:"reservedName",value:a}]}return[0,void 0]},function(e,n){return function(e,n,t,r){var a=t[r],u=0,i="";if(!a||!n.test(a))return[0,void 0];for(;a&&n.test(a);)i+=a,a=t[r+(u+=1)];return[u,{type:e,value:i}]}("name",on,e,n)},function(e,n){return"&rest"===e.substr(n,5)?[5,{type:"modifier",value:"&rest"}]:"&opt"===e.substr(n,4)?[4,{type:"modifier",value:"&opt"}]:"&bind"===e.substr(n,5)?[5,{type:"modifier",value:"&bind"}]:[0,void 0]},function(e,n){if("#"!==e[n])return[0,void 0];var t=fn(e,n+1),r=t[0],a=t[1];return a?[r+1,{type:"regexpShorthand",value:a.value}]:[0,void 0]},function(e,n){return"#("!==e.slice(n,n+2)?[0,void 0]:[1,{type:"fnShorthand",value:"#"}]}];var yn=function(){function e(){this.importScope={}}return e.prototype.tokenize=function(e){return function(e){for(var n=[],t=0,r=!1;t<e.length;){r=!1;for(var a=0,u=gn;a<u.length;a++){var i=(0,u[a])(e,t),o=i[0],l=i[1];if(o>0&&(r=!0,t+=o,l)){n.push(l);break}}if(!r)throw new SyntaxError("Unrecognized character at position "+t+": '"+e[t]+"'")}return n}(e)},e.prototype.parse=function(e){return function(e){for(var n,t,r={type:"Program",body:[]},a=0;a<e.length;)a=(n=un(e,a))[0],t=n[1],r.body.push(t);return r}(e)},e.prototype.evaluate=function(e,n){void 0===n&&(n={});var t=n.globalContext||{};return n.vars&&Object.entries(n.vars).forEach((function(e){var n=e[0],r=e[1];t[n]={value:K(r)}})),We(e,t,this.importScope)},e.prototype.run=function(e,n){var t=this.tokenize(e),r=this.parse(t);return this.evaluate(r,n)},e.prototype.import=function(e){var n=this.tokenize(e),t={};We(this.parse(n),t,{});for(var r=Object.keys(this.importScope),a=0,u=Object.keys(t);a<u.length;a++){var i=u[a];if(r.includes(i))throw Error('Import faild, imported function/variable already exists: "'+i+'"');ne(i,[{},{}],ze)}Object.assign(this.importScope,t)},e}();return e.Lispish=yn,e.isLispishFunction=S,e.normalExpressionKeys=Ge,e.reservedNames=ee,e.specialExpressionKeys=Ye,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=lispish.iife.js.map
