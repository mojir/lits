## LLM Prompt: Lits Namespace & Import System Design

### Context

**Lits** is a functional programming language with algebraic notation and JavaScript interoperability. It's NOT traditional Lisp - it uses modern syntax with infix operators, arrow functions, and structured control flow.

**Syntax examples:**
```lits
// Variables and functions
let square = x -> x * x;
let add = (a, b) -> a + b;

// Control flow
if a > 0 then "positive" else "negative" end;

// Collections
[1, 2, 3] map -> $ * 2;    // => [2, 4, 6]
{ name: "Alice", age: 30 };

// Blocks
{
  let temp = 42;
  temp * 2
};
```

### Project Goal

Refactor the builtin function architecture to support:

1. **Core functions** - Always available without import (minimal bundle)
2. **Namespace modules** - Must be imported explicitly via `import()`

---

## COMPLETED WORK

### Phase 1-3: DONE ✅

The `import()` system is fully implemented for the `grid` namespace.

**Working syntax:**
```lits
// Import entire namespace - returns object with all functions
let grid = import("grid");
grid.transpose([[1, 2], [3, 4]]);

// Import single function directly (callable)
let transpose = import("grid.transpose");
transpose([[1, 2], [3, 4]]);

// Import by alias
let tr = import("grid.tr");  // "tr" is alias for "transpose"
tr([[1, 2], [3, 4]]);

// Destructuring works
let { transpose, rotate } = import("grid");
```

### Key Implementation Details

**New type: `NamespaceFunction`** (in `src/parser/types.ts`):
```typescript
interface NamespaceFunction {
  functionType: 'Namespace'
  namespaceName: string
  functionName: string
  arity: Arity
}
```

**Registry pattern** (in `src/namespaces/registry.ts`):
- `registerNamespace(namespace)` - Register a namespace
- `getNamespace(name)` - Get namespace by name
- `hasNamespace(name)` - Check if namespace exists
- `getNamespaceNames()` - List all registered namespaces

**`import()` function** (in `src/builtin/normalExpressions/categories/misc.ts`):
- `import("grid")` → Returns object with `NamespaceFunction` values for all functions + aliases
- `import("grid.row")` → Returns single `NamespaceFunction` directly (callable)
- Supports aliases (e.g., `import("grid.tr")` returns transpose function)

**Executor** (in `src/evaluator/functionExecutors.ts`):
- `Namespace` case looks up the namespace and function, then evaluates

### Current Codebase Structure

```
src/namespaces/                    # NEW - Namespace system
  index.ts                         # Exports & auto-registers grid
  interface.ts                     # LitsNamespace interface
  registry.ts                      # Namespace registry (Map-based)
  grid/                            # Grid namespace (MIGRATED)
    index.ts                       # Namespace definition with all functions
    grid.test.ts                   # Tests (52 passing)
    transpose.ts                   # Shared helper
    fromArray.ts                   # Shared helper

src/builtin/normalExpressions/categories/
  misc.ts                          # Contains import() function
  namespaces/                      # OLD location - namespaces to migrate
    linearAlgebra/                 # TODO: Migrate
    matrix/                        # TODO: Migrate
    numberTheory/                  # TODO: Migrate
    random/                        # TODO: Migrate
    vector/                        # TODO: Migrate

src/parser/types.ts                # NamespaceFunction type
src/constants/constants.ts         # 'Namespace' in LitsFunctionType
src/evaluator/functionExecutors.ts # Namespace executor
```

### Tests Status

- Grid namespace: **52 tests passing** (including 5 new dot-notation import tests)
- All tests run via: `npm test -- --run src/namespaces/grid/grid.test.ts`

---

## REMAINING WORK

### Phase 4: Migrate Other Namespaces

For each namespace in `src/builtin/normalExpressions/categories/namespaces/`:

1. **Create new folder**: `src/namespaces/<name>/`
2. **Create `index.ts`** with namespace definition (copy pattern from `grid/index.ts`)
3. **Move tests** to new location
4. **Update imports** in `src/namespaces/index.ts` to register the namespace
5. **Delete old folder** from `src/builtin/normalExpressions/categories/namespaces/`
6. **Fix any cross-references** (e.g., matrix uses grid's transpose)

**Namespaces to migrate:**
- `matrix` - Matrix operations (depends on grid.transpose)
- `vector` - Vector/statistics operations  
- `linearAlgebra` - Linear algebra operations
- `numberTheory` - Number theory (primes, sequences, etc.)
- `random` - Random number generation

### Phase 5: Remove Old Infrastructure

- Delete `src/builtin/normalExpressions/categories/namespaces/` folder entirely
- Remove any namespace-related code from `src/builtin/normalExpressions/index.ts`
- Clean up unused imports

### Phase 6: JavaScript API (Future)

Implement `lits.registerNamespace()` for runtime namespace registration:
```typescript
import { Lits } from '@lits/core'
import { grid } from '@lits/grid'

const lits = new Lits()
lits.registerNamespace(grid)
```

---

## Key Files Reference

**Namespace system:**
- `src/namespaces/registry.ts` - Registry implementation
- `src/namespaces/interface.ts` - `LitsNamespace` interface
- `src/namespaces/index.ts` - Exports and auto-registration
- `src/namespaces/grid/index.ts` - Example namespace (use as template)

**Import function:**
- `src/builtin/normalExpressions/categories/misc.ts` - `import()` implementation

**Type definitions:**
- `src/parser/types.ts` - `NamespaceFunction` interface
- `src/constants/constants.ts` - `LitsFunctionType` union

**Executor:**
- `src/evaluator/functionExecutors.ts` - `Namespace` executor case

---

## Quick Commands

```bash
# Run all tests
npm test

# Run grid namespace tests only
npm test -- --run src/namespaces/grid/grid.test.ts

# Type check
npm run typecheck
```
